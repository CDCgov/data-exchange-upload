plugins {
    id 'java'
    id 'java-library'
    id 'application'    
}

group 'cdc.gov.upload.client'
version '1.0-SNAPSHOT'

repositories {
    mavenCentral()
}

jar {
    duplicatesStrategy = DuplicatesStrategy.EXCLUDE

    manifest {
        attributes(
            'Build-Timestamp': new java.text.SimpleDateFormat("yyyy-MM-dd'T'HH:mm:ss.SSSZ").format(new Date()),
            'Created-By'     : "Gradle ${gradle.gradleVersion}",
            'Build-Jdk'      : "${System.properties['java.version']} (${System.properties['java.vendor']} ${System.properties['java.vm.version']})",
            'Build-OS'       : "${System.properties['os.name']} ${System.properties['os.arch']} ${System.properties['os.version']}",
            'Main-Class'     : 'cdc.gov.upload.client.FileUploader'
        )
    }

    from {
        configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
    }
}

task runTest(type: JavaExec) {
    dependsOn 'build'
    main = '-jar'
    classpath = sourceSets.main.runtimeClasspath
    args = ['build/libs/dex-upload-client-1.0-SNAPSHOT.jar']
}


dependencies {
    implementation 'com.squareup.okhttp3:okhttp:4.9.1'
    implementation 'com.fasterxml.jackson.core:jackson-databind:2.13.0'
    implementation 'commons-io:commons-io:2.13.0'
    implementation 'io.tus.java.client:tus-java-client:0.5.0'
}