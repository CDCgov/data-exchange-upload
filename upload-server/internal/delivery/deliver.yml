version: 1.0

#azure defaults for ehdi & eicr
az-ehdi-eicr-defaults: &az-ehdi-eicr
  tenant_id: $EHDI_TENANT_ID
  client_id: $EHDI_CLIENT_ID
  client_secret: $EHDI_CLIENT_SECRET

#azure defaults for ncird
az-ncird-defaults: &az-ncird
  endpoint: $NCIRD_ENDPOINT
  container_name: $NCIRD_CHECKPOINT_CONTAINER_NAME
  tenant_id: $NCIRD_TENANT_ID
  client_id: $NCIRD_CLIENT_ID
  client_secret: $NCIRD_CLIENT_SECRET

#azure defaults for edav
az-edav-defaults: &az-edav
  endpoint: $EDAV_ENDPOINT
  destination_container: $EDAV_CHECKPOINT_CONTAINER_NAME
  tenant_id: $EDAV_TENANT_ID
  client_id: $EDAV_CLIENT_ID
  client_secret: $EDAV_CLIENT_SECRET

#s3 defaults
s3-defaults: &s3
  endpoint: http://localhost:4566
  access_key_id: $S3_ACCESS_KEY_ID
  secret_access_key: $S3_SECRET_ACCESS_KEY
  region: us-east-1

programs:
  - data_stream_id: ehdi
    data_stream_route: csv
    path_template: $EHDI_PATH_TEMPLATE
    delivery_targets:
      - name: ehdi
        type: s3
        <<: *s3
        bucket_name: target
      - name: ehdi-backup
        type: s3
        <<: *s3
        bucket_name: backup
      - name: ehdi-local
        type: file
        directory: $LOCAL_EHDI_FOLDER
  #   - name: ehdi-az
  #     az-blob:
  #       <<: *az-ehdi-eicr
  #       endpoint: $EHDI_ENDPOINT
  #       destination_container: $EHDI_CHECKPOINT_CONTAINER_NAME
  #       path_template: $EHDI_PATH_TEMPLATE
  - data_stream_id: eicr
    data_stream_route: fhir
    path_template: $EICR_PATH_TEMPLATE
    delivery_targets:
      - name: eicr
        type: s3
        <<: *s3
        bucket_name: target